<html>
	<meta charset="utf-8">
	<head>
		<title>Parallel coordinates display</title>
		<style>

		svg {
		  font: 10px sans-serif;
		}

		.background path {
		  fill: none;
		  stroke: #ddd;
		  shape-rendering: crispEdges;
		}

		.foreground path {
		  fill: none;
		  stroke: steelblue;
		}

		.brush .extent {
		  fill-opacity: .3;
		  stroke: #fff;
		  shape-rendering: crispEdges;
		}

		.header {
			font-family: serif;
			font-size: 14px;
		}

		.axis line,
		.axis path {
		  fill: none;
		  stroke: #000;
		  shape-rendering: crispEdges;
		}

		.axis text {
		  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
		}

		ul {
			list-style-type: none;
			}

		ul li {
			display: inline;
		}

		h1,h3 {
			text-align: center;
		}

		</style>
	</head>
	<body>
		<ul>
			<li><a href="../Scatterplot">Bivariate scatterplot</a></li>
			<li>|</li>
			<li><a href="../Correlation">Correlation matrix</a></li>
			<li>|</li>
			<li><a href="../Scatterplot_matrix">Scatterplot matrix</a></li>
			<li>|</li>
			<li><a href="../Parallel">Parallel Coordinates display</a></li>
			<li>|</li>
			<li><a href="../PCA">PCA plot</a></li>
			<li>|</li>
			<li><a href="../Scree">Scree plot</a></li>
			<li>|</li>
			<li><a href="../Biplot">Biplot</a></li>
			<li>|</li>
			<li><a href="../MDS_data">MDS display of data</a></li>
			<li>|</li>
			<li><a href="../MDS_attributes">MDS display of attributes</a></li>
		</ul>
		<hr>
		<div></div>
	<script src="//d3js.org/d3.v4.min.js"></script>
	<script>

	var margin = {top: 60, right: 10, bottom: 10, left: 10},
	    width = 1280 - margin.left - margin.right,
	    height = 600 - margin.top - margin.bottom;

	var x = d3.scaleBand().rangeRound([0,width]),
	    y = {};

	var line = d3.line(),
	    axis = d3.axisLeft(),
	    background,
	    foreground;

	var svg = d3.select("div").append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
	  .append("g")
	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	d3.csv("parallel.csv", function(error, cars) {

	  // Extract the list of dimensions and create a scale for each.
	  x.domain(dimensions = d3.keys(cars[0]).filter(function(d) {
	    return d != "name" && (y[d] = d3.scaleLinear()
	        .domain(d3.extent(cars, function(p) { return +p[d]; }))
	        .range([height, 0]));
	  }));

	  //Make the title
	  var title = svg.append("text")
	  					.text("Parallel Coordinates Display") //Pop off the column header and make it the title
	  					.attr("class","title") 
	  					.attr("x",500)
	  					.attr("y",-30)
	  					.attr("class","header");

	  // Add grey background lines for context.
	  background = svg.append("g")
	      .attr("class", "background")
	    .selectAll("path")
	      .data(cars)
	    .enter().append("path")
	      .attr("d", path);

	  // Add blue foreground lines for focus.
	  foreground = svg.append("g")
	      .attr("class", "foreground")
	    .selectAll("path")
	      .data(cars)
	    .enter().append("path")
	      .attr("d", path);

	  // Add a group element for each dimension.
	  var g = svg.selectAll(".dimension")
	      .data(dimensions)
	    .enter().append("g")
	      .attr("class", "dimension")
	      .attr("transform", function(d) { 
	      	return "translate(" + x(d) + ")"; });

	  // Add an axis and title.
	  g.append("g")
	      .attr("class", "axis")
	      .each(function(d) { d3.select(this).call(axis.scale(y[d])); })
	    .append("text")
	      .style("text-anchor", "middle")
	      .attr("y", -9)
	      .text(function(d) { return d; });

	  // Add and store a brush for each axis.
	  g.append("g")
	      .attr("class", "brush")
	      .each(function(d) { 
	      	d3.select(this).call(
	      			y[d].brush = d3.brushY().extent(y[d].range()).on("brush", brush)
	      		); 
	      })
	    .selectAll("rect")
	      .attr("x", -8)
	      .attr("width", 16);
	});

	// Returns the path for a given data point.
	function path(d) {
	  return line(dimensions.map(function(p) { 
	  	return [x(p), y[p](d[p])]; }));
	}

	// Handles a brush event, toggling the display of foreground lines.
	function brush() {
	  var actives = dimensions.filter(function(p) { 
	  	return d3.brushSelection(y[p].brush) != null; 
	  }),
	      extents = actives.map(function(p) { return d3.brushSelection(y[p].brush); });
	      console.log(extents);
	  foreground.style("display", function(d) {

	    return actives.every(function(p, i) {
	      return extents[i][0] <= d[p] && d[p] <= extents[i][1];
	    }) ? null : "none";
	  });
	}

	</script>
</html>